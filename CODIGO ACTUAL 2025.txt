CODIGO ACTUAL 2025


Sistema.cpp

#include <iostream>
#include <fstream>
#include <vector>
#include <string>
#include <memory>
#include <sstream>
#include "Usuario.h"
#include "Cliente.h"
#include "AdministradorDeSesion.h"

using namespace std;

struct Vuelo {
    int numeroVuelo;
    string fecha;
    string hora;
    string origen;
    string destino;
    int numeroAvion;
    bool asientos[10]{ false }; 

    bool reservarAsiento(int asiento) {
        if (asiento < 1 || asiento > 10) return false;
        if (asientos[asiento - 1]) return false; 
        asientos[asiento - 1] = true;
        return true;
    }
};

vector<Vuelo> cargarVuelos(const string& archivo) {
    vector<Vuelo> vuelos;
    ifstream in(archivo);
    if (!in.is_open()) return vuelos;

    string line;
    while (getline(in, line)) {
        if (line.empty()) continue;
        stringstream ss(line);
        Vuelo v;
        ss >> v.numeroVuelo >> v.fecha >> v.hora >> v.origen >> v.destino >> v.numeroAvion;
        for (int i = 0; i < 10; i++) v.asientos[i] = false; 
        vuelos.push_back(v);
    }
    in.close();
    return vuelos;
}

void guardarVuelos(const string& archivo, const vector<Vuelo>& vuelos) {
    ofstream out(archivo);
    for (const auto& v : vuelos)
        out << v.numeroVuelo << " " << v.fecha << " " << v.hora << " "
        << v.origen << " " << v.destino << " " << v.numeroAvion << "\n";
}

void CrearAdminPorDefecto() {
    ifstream archivo("admin.txt");
    if (!archivo.is_open() || archivo.peek() == ifstream::traits_type::eof()) {
        ofstream salida("admin.txt", ios::app);
        salida << "1 admin1 admin@tec.mx 1234 admin" << endl;
        salida.close();
    }
}

bool ReservarVueloCliente(int idCliente) {
    vector<Vuelo> vuelos = cargarVuelos("vuelos.txt");

    cout << "Vuelos disponibles\n";
    for (const auto& v : vuelos)
        cout << "Vuelo " << v.numeroVuelo
        << "  Fecha: " << v.fecha
        << "  Hora: " << v.hora
        << "  " << v.origen << " -> " << v.destino
        << "  Avion: " << v.numeroAvion << "\n";
    cout << "\n";

    int numVuelo, numAsiento;
    cout << "Ingrese el número de vuelo a reservar: ";
    cin >> numVuelo;

    Vuelo* vueloSeleccionado = nullptr;
    for (auto& v : vuelos) {
        if (v.numeroVuelo == numVuelo) {
            vueloSeleccionado = &v;
            break;
        }
    }

    if (!vueloSeleccionado) {
        cout << "Vuelo no encontrado.\n";
        return false;
    }

    cout << "Ingrese número de asiento (1-10): ";
    cin >> numAsiento;

    if (!vueloSeleccionado->reservarAsiento(numAsiento)) {
        cout << "Asiento ocupado o inválido.\n";
        return false;
    }

    ofstream out("reservaciones.txt", ios::app);
    out << idCliente << " " << vueloSeleccionado->numeroVuelo << " " << numAsiento << " 0\n";
    out.close();

    guardarVuelos("vuelos.txt", vuelos);

    cout << "Vuelo reservado exitosamente! Puede pagar ahora o después.\n";
    return true;
}

void PagarReservacion(int idCliente) {
    vector<string> lineas;
    ifstream in("reservaciones.txt");
    string line;
    while (getline(in, line)) {
        lineas.push_back(line);
    }
    in.close();

    bool encontrada = false;
    for (auto& l : lineas) {
        stringstream ss(l);
        int userId, vueloNum, asiento, pagado;
        ss >> userId >> vueloNum >> asiento >> pagado;
        if (userId == idCliente && pagado == 0) {
            cout << "Pagando vuelo " << vueloNum << " asiento " << asiento << "...\n";
            string tarjeta;
            cout << "Ingrese numero de tarjeta (sin espacios): ";
            cin >> tarjeta;
            pagado = 1;
            l = to_string(userId) + " " + to_string(vueloNum) + " " + to_string(asiento) + " " + to_string(pagado);
            cout << "Pago exitoso!\n";
            encontrada = true;
        }
    }

    ofstream out("reservaciones.txt");
    for (auto& l : lineas) out << l << "\n";

    if (!encontrada) cout << "No hay reservas pendientes.\n";
}

int main() {
    CrearAdminPorDefecto();
    AdministradorDeSesion adminDeSesion;

    int opcion;
    do {
        system("cls");
        cout << "1 - Iniciar sesión\n2 - Salir\nAdmin predefinido: admin@tec.mx 1234\n";
        cin >> opcion;

        if (opcion == 1) {
            int tipoUsuario;
            cout << "1 - Administrador\n2 - Cliente\n";
            cin >> tipoUsuario;

            if (tipoUsuario == 1) {
                string correo, password;
                cout << "Correo: "; cin >> correo;
                cout << "Password: "; cin >> password;

                auto admins = Usuario::ObtenerUsuarios("admin.txt");

                if (adminDeSesion.login(correo, password, admins)) {
                    auto adminLogueado = adminDeSesion.getSesionUsuario(admins.back()->getId());

                    int opcionAdmin;
                    do {
                        system("cls");
                        cout << "1 - Registrar administrador\n";
                        cout << "2 - Registrar cliente\n";
                        cout << "3 - Crear vuelo\n";
                        cout << "4 - Cerrar sesión\n";
                        cin >> opcionAdmin;

                        if (opcionAdmin == 1) {
                            string nombre, correoN, passwordN;
                            cout << "Nombre: "; cin.ignore(); getline(cin, nombre);
                            cout << "Correo: "; cin >> correoN;
                            cout << "Password: "; cin >> passwordN;
                            size_t nuevoId = admins.size() + 1;
                            Usuario::RegistrarUsuario("admin.txt", nuevoId, nombre, correoN, passwordN, "admin");
                        }
                        else if (opcionAdmin == 2) {
                            string nombre, correoN, passwordN;
                            cout << "Nombre: "; cin.ignore(); getline(cin, nombre);
                            cout << "Correo: "; cin >> correoN;
                            cout << "Password: "; cin >> passwordN;
                            auto clientesList = Usuario::ObtenerUsuarios("clientes.txt");
                            size_t nuevoId = clientesList.size() + 1;
                            Usuario::RegistrarUsuario("clientes.txt", nuevoId, nombre, correoN, passwordN, "cliente");
                        }
                        else if (opcionAdmin == 3) {
                            int numVuelo, numAvion;
                            string fecha, hora, origen, destino;
                            cout << "Número de vuelo: "; cin >> numVuelo;
                            cout << "Número de avión: "; cin >> numAvion;
                            cout << "Fecha: "; cin >> fecha;
                            cout << "Hora: "; cin >> hora;
                            cout << "Origen: "; cin >> origen;
                            cout << "Destino: "; cin >> destino;

                            vector<Vuelo> vuelos = cargarVuelos("vuelos.txt");
                            Vuelo nuevo = { numVuelo, fecha, hora, origen, destino, numAvion };
                            vuelos.push_back(nuevo);
                            guardarVuelos("vuelos.txt", vuelos);
                            cout << "Vuelo creado!\n";
                            cin.ignore(); cin.get();
                        }
                    } while (opcionAdmin != 4);

                    adminDeSesion.logout(adminLogueado->getId());
                }
                else {
                    cout << "Error: usuario o password incorrectos.\n";
                    cin.ignore(); cin.get();
                }
            }
            else if (tipoUsuario == 2) {
                auto clientes = Usuario::ObtenerUsuarios("clientes.txt");
                string correo, password;
                cout << "Correo: "; cin >> correo;
                cout << "Password: "; cin >> password;

                bool logueado = false;
                size_t idCliente = 0;
                for (auto& c : clientes) {
                    if (c->ValidarInicioSesion(correo, password)) {
                        logueado = true;
                        idCliente = c->getId();
                        adminDeSesion.login(correo, password, clientes);
                        break;
                    }
                }

                if (logueado) {
                    int opcionCliente;
                    do {
                        system("cls");
                        cout << "1 - Reservar vuelo\n2 - Pagar boleto\n3 - Salir\n";
                        cin >> opcionCliente;

                        if (opcionCliente == 1) ReservarVueloCliente(idCliente);
                        else if (opcionCliente == 2) PagarReservacion(idCliente);

                    } while (opcionCliente != 3);

                    adminDeSesion.logout(idCliente);
                }
                else {
                    cout << "Error: usuario o password incorrectos.\n";
                    cin.ignore(); cin.get();
                }
            }
        }
    } while (opcion != 2);

    return 0;
}



Usuario.h 

#pragma once
#include <string>
#include <vector>
#include <memory>
#include <fstream>
#include <iostream>
#include <sstream>

class Usuario
{
protected:
    size_t id;  
    std::string nombre;
    std::string correo;
    std::string password;
    std::string rol;

public:
    Usuario() : id(0) {}
    Usuario(size_t _id, const std::string& _nombre, const std::string& _correo,
        const std::string& _password, const std::string& _rol)
        : id(_id), nombre(_nombre), correo(_correo), password(_password), rol(_rol) {
    }

    size_t getId() const { return id; }
    std::string getCorreo() const { return correo; }
    std::string getRol() const { return rol; }
    std::string getNombre() const { return nombre; }

    bool ValidarInicioSesion(const std::string& email, const std::string& pass) const
    {
        return correo == email && password == pass;
    }

    static std::vector<std::shared_ptr<Usuario>> ObtenerUsuarios(const std::string& archivo)
    {
        std::vector<std::shared_ptr<Usuario>> usuarios;
        std::ifstream inputFile(archivo);
        if (!inputFile.is_open()) return usuarios;

        std::string line;
        while (std::getline(inputFile, line))
        {
            if (line.empty()) continue;

            std::stringstream ss(line);
            size_t _id;
            std::string _nombre, _correo, _password, _rol;

            ss >> _id;
            ss.ignore(); 
            ss >> _nombre >> _correo >> _password >> _rol;

            usuarios.push_back(std::make_shared<Usuario>(_id, _nombre, _correo, _password, _rol));
        }

        inputFile.close();
        return usuarios;
    }

    static bool RegistrarUsuario(const std::string& archivo, size_t _id, const std::string& _nombre,
        const std::string& _correo, const std::string& _password, const std::string& _rol)
    {
        std::ofstream outputFile(archivo, std::ios::app);
        if (!outputFile.is_open()) return false;

        outputFile << _id << " " << _nombre << " " << _correo << " " << _password << " " << _rol << std::endl;
        outputFile.close();
        return true;
    }
};



Cliente.h 

#pragma once
#include "Usuario.h"
#include "AdministradorDeSesion.h"
#include <iostream>
#include <vector>
#include <memory>

class Cliente : public Usuario
{
public:
    Cliente() {}
    Cliente(size_t _id, const std::string& _nombre, const std::string& _correo,
        const std::string& _password, const std::string& _rol)
        : Usuario(_id, _nombre, _correo, _password, _rol) {
    }

    int IniciarSesionCliente(AdministradorDeSesion& adminDeSesion)
    {
        system("cls");
        std::string correoLogin, passwordLogin;
        std::cout << "Correo: "; std::cin >> correoLogin;
        std::cout << "Password: "; std::cin >> passwordLogin;

        auto clientes = Usuario::ObtenerUsuarios("clientes.txt");

        for (auto& cliente : clientes)
        {
            if (cliente->ValidarInicioSesion(correoLogin, passwordLogin))
            {
                adminDeSesion.login(correoLogin, passwordLogin, clientes);
                return static_cast<int>(cliente->getId());
            }
        }
        return -1; 
    }
};



Menu.h 

#pragma once
#include "Usuario.h"
#include <iostream>

class Menu
{
public:
    void MostrarMenu(std::shared_ptr<Usuario> cliente)
    {
        int opcion;
        do {
            system("cls");
            std::cout << "---- MENU DE VUELOS ----\n";
            std::cout << "1 - Reservar vuelo\n";
            std::cout << "2 - Pagar boleto\n";
            std::cout << "3 - Salir\n";
            std::cin >> opcion;

            switch (opcion)
            {
            case 1: std::cout << "Reservando vuelo...\n"; break;
            case 2: std::cout << "Pagando boleto...\n"; break;
            case 3: std::cout << "Saliendo...\n"; break;
            default: std::cout << "Opción inválida.\n"; break;
            }
            std::cin.ignore(); std::cin.get();
        } while (opcion != 3);
    }
};



AdmininstradorDeSesion.h

#pragma once
#include <map>
#include <memory>
#include <vector>
#include <string>
#include "Usuario.h"

class AdministradorDeSesion
{
private:
    std::map<size_t, std::shared_ptr<Usuario>> sesionesActivas;

public:
    bool login(const std::string& email, const std::string& password,
        const std::vector<std::shared_ptr<Usuario>>& usuarios)
    {
        for (const auto& usuario : usuarios)
        {
            if (usuario->ValidarInicioSesion(email, password))
            {
                sesionesActivas[usuario->getId()] = usuario;
                return true;
            }
        }
        return false;
    }

    void logout(size_t userId)
    {
        sesionesActivas.erase(userId);
    }

    bool isLoggedIn(size_t userId) const
    {
        return sesionesActivas.find(userId) != sesionesActivas.end();
    }

    std::shared_ptr<Usuario> getSesionUsuario(size_t idUsuario) const
    {
        auto it = sesionesActivas.find(idUsuario);
        if (it != sesionesActivas.end())
        {
            return it->second;
        }
        return nullptr;
    }
}; 




Vuelo.h

#pragma once
#include <string>
#include <iostream>
#include <sstream>
#include <vector>

class Vuelo {
private:
    int numeroVuelo;
    std::string fecha;
    std::string hora;
    std::string origen;
    std::string destino;
    int numeroAvion;
    bool asientos[10]; 

public:
    Vuelo() {
        for (int i = 0; i < 10; i++) asientos[i] = false;
    }

    Vuelo(int numV, const std::string& f, const std::string& h, const std::string& o, const std::string& d, int numA)
        : numeroVuelo(numV), fecha(f), hora(h), origen(o), destino(d), numeroAvion(numA) {
        for (int i = 0; i < 10; i++) asientos[i] = false;
    }

    int getNumeroVuelo() const { return numeroVuelo; }

    bool reservarAsiento(int n) {
        if (n < 1 || n>10) return false;
        if (asientos[n - 1]) return false;
        asientos[n - 1] = true;
        return true;
    }

    void mostrarVuelo() const {
        std::cout << "Vuelo " << numeroVuelo << " - Avion " << numeroAvion
            << " | " << fecha << " " << hora
            << " | " << origen << " -> " << destino << "\n";
        std::cout << "Asientos: ";
        for (int i = 0; i < 10; i++)
            std::cout << (asientos[i] ? "X" : "O") << " ";
        std::cout << "\n";
    }

    std::string toString() const {
        std::ostringstream oss;
        oss << numeroVuelo << " " << fecha << " " << hora << " " << origen << " " << destino << " " << numeroAvion;
        for (int i = 0; i < 10; i++) oss << " " << asientos[i];
        return oss.str();
    }

    static Vuelo fromString(const std::string& line) {
        std::istringstream iss(line);
        int numV, numA;
        std::string f, h, o, d;
        Vuelo v;
        iss >> numV >> f >> h >> o >> d >> numA;
        v = Vuelo(numV, f, h, o, d, numA);
        for (int i = 0; i < 10; i++) {
            bool a; iss >> a; v.asientos[i] = a;
        }
        return v;
    }
};
